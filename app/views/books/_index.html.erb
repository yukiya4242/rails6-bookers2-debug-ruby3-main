<table class='table table-hover table-inverse'>
<thead>
<tr>
<th></th>
<th>Title</th>
<th>Opinion</th>
<th colspan="3"></th>
</tr>
</thead>
<tbody>
  <% @books.each do |book| %>
  <tr>
    <td><%= link_to book.title,book %></td>
    <td><%= book.body %></td>
    <td>
      <div class="likes<%= ' liked' if book.favorites.find_by(user_id: current_user.id) %>">
        <span class="like-count <%= 'blue' if book.favorites.count.zero? %>"><%= book.favorites.count %></span>
        <%= button_to book_favorites_path(book), method: :post, class: "like-button", remote: true do %>
          <% if book.favorites.find_by(user_id: current_user.id) %>
            <%#= icon('fas', 'heart') %>
            <i class="fas fa-heart"></i>
          <% else %>
            <%#= icon('far', 'heart') %>
            <i class="fas fa-heart"></i>
          <% end %>
        <% end %>
      </div>
    </td>
  </tr>
  <% end %>
</tbody>
</table>




<style>
.likes {
display: inline-flex;
align-items: center;
font-size: 1rem;
color: blue;
}
.likes.liked {
color: red;
}
.like-count {
margin-right: 0.25rem;
}
.like-button {
padding: 0;
background-color: transparent;
border: none;
}
.like-button:hover {
cursor: pointer;
}
.blue {
color: blue;
}
.red {
color: red;
}
</style>



<script>
$(document).on('ajax:success', '.like-button', function(event) {
  var $button = $(event.currentTarget);
  var $likesDiv = $button.closest('.likes');
  var isLiked = $button.find('.fa-heart').hasClass('fas');
  var likesCount = parseInt($likesDiv.find('.like-count').text());
  if (isLiked) {
    $likesDiv.removeClass('liked');
    $button.html('<i class="far fa-heart"></i>');
    $likesDiv.find('.like-count').text(likesCount - 1);
    $likesDiv.removeClass('red').addClass('blue');
  } else {
    $likesDiv.addClass('liked');
    $button.html('<i class="fas fa-heart"></i>');
    $likesDiv.find('.like-count').text(likesCount + 1);
    $likesDiv.removeClass('blue').addClass('red');
  }
});
</script>
